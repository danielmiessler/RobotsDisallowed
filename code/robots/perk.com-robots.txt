<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Page Not found | Perk</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
            
        <script src="https://cdn2.perk.com/assets/js/http_redirect.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="https://cdn2.perk.com/assets/perk_shopping/js/bjqs.js"></script>
    <link rel="stylesheet" href="https://cdn2.perk.com/assets/perk_shopping/css/style.css?ver=1.0.4">
    <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500' rel='stylesheet' type='text/css'>
    <script src="https://cdn2.perk.com/assets/perk_shopping/js/shop.js" type="text/javascript"></script>
    <script src="https://cdn2.perk.com/assets/perk_shopping/js/modernizr.js" type="text/javascript"></script>
    <script src="https://cdn2.perk.com/assets/perk_shopping/js/shop_event_tracking.js" type="text/javascript"></script>
    <script src="https://cdn2.perk.com/js/jquery.zclip.min.js" type="text/javascript"></script>
    <script src="https://cdn2.perk.com/assets/js/validations.js" type="text/javascript"></script>
    <script src="https://cdn2.perk.com/assets/js/api.js?v=2.1.2" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/jquery.mixitup/latest/jquery.mixitup.min.js"></script>
    <script src="https://cdn2.perk.com/assets/perk_shopping/js/trunk8.js"></script>

    <script type="text/javascript">
            
        </script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-32583342-1', 'auto');
        ga('send', 'pageview');

    </script>
    </head>
<body id="desktop">
    
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJQTWT"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-TJQTWT');
    </script>
    <!-- End Google Tag Manager -->

    <div id="realm" data-realm="prod" style="display: none;"></div>
        <div class="top-header">
    <div class="wrapper">
        <div class="logo"><a href="#"><img src="https://cdn2.perk.com/assets/perk_shopping/images/logo.png" alt="logo"></a></div>
        <ul class="top-menu">
            <li><a href="/shop" class="active">Shop</a></li>
            <li><a href="/sweepstakes">Sweepstakes</a></li>
            <li><a href="/perk/waystospend">Redeem</a></li>
            <li><a href="#" id="perkapps-link">Perk Apps</a></li>
            <li><a href="/perk/search">Perk Search</a></li>
        </ul>
        <div class="perk-apps">
            <div class="main-title">Download Perk Apps</div>
            <div class="filter" data-filter=".android">ANDROID</div>
            <div class="filter" data-filter=".ios">iOS</div>
            <div class="filter" data-filter=".kindle">KINDLE</div>
            
            <div id="all-apps">
                <div class="android-wrap">
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.jutera.perkmobile&hl=en" target="_blank"><span class="browser">Browser</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.perk.screen" target="_blank"><span class="screen">Screen</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.jutera.perkprizemob.aphone" target="_blank"><span class="ppm">Prize Mob</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.jutera.perkshopping.atab" target="_blank"><span class="shopping">Shopping</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.perk.livetv.aphone" target="_blank"><span class="tv-live">Live TV</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.jutera.perksearch&hl=en" target="_blank"><span class="search">Search & Win</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.juteralabs.perktv" target="_blank"><span class="tv">TV</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.jutera.perkpopquiz.aphone" target="_blank"><span class="ppq">POP Quiz</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.perk.scratchandwin.aphone" target="_blank"><span class="scratch">Scratch & Win</span></a></div>
                    <div class="app android"><a href="https://play.google.com/store/apps/details?id=com.jutera.perkwallet.aphone" target="_blank"><span class="wallet">Wallet</span></a></div>
                </div>
                <div class="ios-wrap">
                    <div class="app ios"><a href="https://itunes.apple.com/us/app/perk-web-browser-get-rewards/id663531366?mt=8" target="_blank"><span class="browser">Browser</span></a></div>
                    <div class="app ios"><a href="https://itunes.apple.com/us/app/perk-shopping-get-rewards/id696443133?mt=8" target="_blank"><span class="shopping">Shopping</span></a></div>
                    <div class="app ios"><a href="https://itunes.apple.com/us/app/perk-search/id634875415?mt=8" target="_blank"><span class="search">Search & Win</span></a></div>
                    <div class="app ios"><a href="https://itunes.apple.com/us/app/perk-tv-get-rewards-when-you/id706630901" target="_blank"><span class="tv">TV</span></a></div>
                    <div class="app ios"><a href="https://itunes.apple.com/au/app/perk-pop-quiz!-get-paid-to/id872720863?mt=8" target="_blank"><span class="ppq">POP Quiz</span></a></div>
                    <div class="app ios"><a href="https://itunes.apple.com/in/app/perk-wallet/id891044525?mt=8" target="_blank"><span class="wallet">Wallet</span></a></div>
                    <div class="app ios"><a href="https://itunes.apple.com/us/app/perk-prize-mob/id916852976?mt=8" target="_blank"><span class="ppm">Prize Mob</span></a></div>
		    <div class="app ios"><a href="https://itunes.apple.com/us/app/perk-scratch-win!/id943994626?mt=8" target="_blank"><span class="scratch">Scratch & Win</span></a></div>
                </div>
                <div class="kindle-wrap">
                    <div class="app kindle"><a href="http://www.amazon.com/Jutera-Labs-Perk-TV/dp/B00JLGCONU" target="_blank"><span class="tv">TV</span></a></div>
                </div>
            </div>
        </div>
                    <div class="section-right">
                <input type="text" placeholder="Search" class="top-search-box" id="search_coupons" name="q" value="" />
                <a href="#" class="button-sign-up" onclick="SHOP_TRACK.trackSignup();">Sign Up</a>
                <a href="#" class="button-log-in" onclick="SHOP_TRACK.trackLogin();">Login</a>
            </div>
            </div>
</div><!-- End top-header -->
    <div class="main-menu">
    <div class="wrapper">
        <ul>
            <li><a href="/shop" ><span class="icon-home"></span>Home</a></li>
            <li><a href="/shop/coupons" >Coupons</a></li>
            <li><a href="/shop/stores" >Stores</a></li>
            <!-- <li><a href="/shop/local"  class="local">Local</a></li> -->
        </ul>
        <div class="main-search">
            <form action="/shop/search" method="GET">
                <input type="text" name="q" id="search_merchant_coupons" placeholder="Walmart, Target, Best Buy, Macy's..." value="">
                <button type="submit">Search</button>
            </form>
        </div>
        <div class="mega-menu">
            <ul class="cats">
                <li>
                    <a href="#">View All Deals</a>
                    <img src="https://cdn2.perk.com/assets/perk_shopping/images/sample-img1.jpg" alt="" style="display: block;">
                </li>
                <li>
                    <a href="#">Restaurants</a>
                    <img src="https://cdn2.perk.com/assets/perk_shopping/images/sample-img2.jpg" alt="">
                </li>
                <li>
                    <a href="#">Coupons</a>
                    <img src="https://cdn2.perk.com/assets/perk_shopping/images/sample-img1.jpg" alt="">
                </li>
                <li>
                    <a href="#">Health &amp; Groceries</a>
                    <img src="https://cdn2.perk.com/assets/perk_shopping/images/sample-img1.jpg" alt="">
                </li>
                <li>
                    <a href="#">Auto &amp; Services</a>
                    <img src="https://cdn2.perk.com/assets/perk_shopping/images/sample-img2.jpg" alt="">
                </li>
                <li>
                    <a href="#">Sports &amp; Fitness</a>
                    <img src="https://cdn2.perk.com/assets/perk_shopping/images/sample-img1.jpg" alt="">
                </li>
                <li>
                    <a href="#">Home Goods</a>
                    <img src="https://cdn2.perk.com/assets/perk_shopping/images/sample-img2.jpg" alt="">
                </li>
            </ul>
        </div>
    </div>
</div><!-- End Main Menu -->
    <div class="wrapper" id="fb-root">
                    <div class="sidebar home">
    <div class="heading">Categories</div>
    <ul class="categories">
                    <li>
                <a href="/shop/category/automotive" class="category" id="automotive">
                    <img src="http://s3-cdn1.perk.com//category/automotive.png" class="category-icon">
                    Automotive                </a>
            </li>
                    <li>
                <a href="/shop/category/baby-kids" class="category" id="baby-kids">
                    <img src="http://s3-cdn1.perk.com//category/baby.png" class="category-icon">
                    Baby & Kids                </a>
            </li>
                    <li>
                <a href="/shop/category/books-magazines" class="category" id="books-magazines">
                    <img src="http://s3-cdn1.perk.com//category/entertainment.png" class="category-icon">
                    Books & Magazines                </a>
            </li>
                    <li>
                <a href="/shop/category/computers-software" class="category" id="computers-software">
                    <img src="http://s3-cdn1.perk.com//category/computers.png" class="category-icon">
                    Computers & Software                </a>
            </li>
                    <li>
                <a href="/shop/category/education" class="category" id="education">
                    <img src="http://s3-cdn1.perk.com//category/education.png" class="category-icon">
                    Education                </a>
            </li>
                    <li>
                <a href="/shop/category/electronics" class="category" id="electronics">
                    <img src="http://s3-cdn1.perk.com//category/electronics.png" class="category-icon">
                    Electronics                </a>
            </li>
                    <li>
                <a href="/shop/category/entertainment" class="category" id="entertainment">
                    <img src="http://s3-cdn1.perk.com//category/event.png" class="category-icon">
                    Entertainment                </a>
            </li>
                    <li>
                <a href="/shop/category/fashion-apparel" class="category" id="fashion-apparel">
                    <img src="http://s3-cdn1.perk.com//category/fashion.png" class="category-icon">
                    Fashion & Apparel                </a>
            </li>
                    <li>
                <a href="/shop/category/flowers-gifts" class="category" id="flowers-gifts">
                    <img src="http://s3-cdn1.perk.com//category/gift.png" class="category-icon">
                    Flowers & Gifts                </a>
            </li>
                    <li>
                <a href="/shop/category/food-drink" class="category" id="food-drink">
                    <img src="http://s3-cdn1.perk.com//category/food.png" class="category-icon">
                    Food & Drink                </a>
            </li>
                    <li>
                <a href="/shop/category/health-beauty" class="category" id="health-beauty">
                    <img src="http://s3-cdn1.perk.com//category/health.png" class="category-icon">
                    Health & Beauty                </a>
            </li>
                    <li>
                <a href="/shop/category/home-garden" class="category" id="home-garden">
                    <img src="http://s3-cdn1.perk.com//category/garden.png" class="category-icon">
                    Home & Garden                </a>
            </li>
                    <li>
                <a href="/shop/category/jewelry-watches" class="category" id="jewelry-watches">
                    <img src="http://s3-cdn1.perk.com//category/jewelry.png" class="category-icon">
                    Jewelry & Watches                </a>
            </li>
                    <li>
                <a href="/shop/category/office-supplies" class="category" id="office-supplies">
                    <img src="http://s3-cdn1.perk.com//category/business.png" class="category-icon">
                    Office Supplies                </a>
            </li>
                    <li>
                <a href="/shop/category/pet-supplies" class="category" id="pet-supplies">
                    <img src="http://s3-cdn1.perk.com//category/pets.png" class="category-icon">
                    Pet Supplies                </a>
            </li>
                    <li>
                <a href="/shop/category/services" class="category" id="services">
                    <img src="http://s3-cdn1.perk.com//category/services.png" class="category-icon">
                    Services                </a>
            </li>
                    <li>
                <a href="/shop/category/shoes" class="category" id="shoes">
                    <img src="http://s3-cdn1.perk.com//category/shoes.png" class="category-icon">
                    Shoes                </a>
            </li>
                    <li>
                <a href="/shop/category/sports-outdoors" class="category" id="sports-outdoors">
                    <img src="http://s3-cdn1.perk.com//category/sports.png" class="category-icon">
                    Sports & Outdoors                </a>
            </li>
                    <li>
                <a href="/shop/category/tax-season" class="category" id="tax-season">
                    <img src="http://s3-cdn1.perk.com//category/tax.png" class="category-icon">
                    Tax Season                </a>
            </li>
                    <li>
                <a href="/shop/category/toys-hobbies" class="category" id="toys-hobbies">
                    <img src="http://s3-cdn1.perk.com//category/toys.png" class="category-icon">
                    Toys & Hobbies                </a>
            </li>
                    <li>
                <a href="/shop/category/travel" class="category" id="travel">
                    <img src="http://s3-cdn1.perk.com//category/travel.png" class="category-icon">
                    Travel                </a>
            </li>
            </ul>
</div><!-- End sidebar -->                <div class="not-found">
    <h2>Looking for something?</h2>
    <div class="not-found-search">
        <form action="/shop/coupons" method="GET">
            <input type="text" name="q" placeholder="Search over 2,000 Coupons &amp; Stores!" value="">
            <button type="submit">Search</button>
        </form>
    </div>
    <p>Oops you have reached a page that doesn't exist</p>
</div>    </div><!-- End Wrapper -->
    <!-- Coupon Overlay starts here -->
    <div class="overlay-fading"></div>
    <div class="overlay" id="coupons">
        <div class="wrap">
            <a class="close" href="#"></a>
            <div class="top-section">
                <div class="store-left">
                    <div class="store-image"><img id="coupon_image" src="https://placehold.it/120x60" alt="store-img"></div><span class="store-name" id="coupon_merchant_name">Merchant</span>
                </div>
                <div class="right-section">
                    <div class="coupon-code" id="coupon_code"></div>
                    <div class="button-copy" id="coupon_copy">Copy</div>
                    <div class="button-copy copied" id="coupon_code_copied">Copied</div>
                    <div class="save-code hide">Save</div>
                    <div class="save-code saved hide">Saved</div>
                    
                    <div class="validity">Valid now through <span id="coupon_validity">11/15/2014</span></div>
                    <div class="store-desc" id="coupon_desc">Shop <a href="#">Macys.com</a> now for Friends &amp; Family - <a href="#">40% off everything</a>, plus free shipping if you spend $50. Hurry, this offer expires today!</div>
                </div>
            </div>
            <div class="middle-section">
                <a href="#" class="info">What are points?</a>
                <div class="points-info-box">
                    <p>You earn <strong>Perk Points</strong> any time you shop online at participating merchants that can be later redeemed for gift cards.</p>
                </div>
                <a href="#" target="_blank" id="coupon_shop_link" class="offer-text">Shop Now and <span id="coupon_shop_text"></span>.</a>
            </div>
            <div class="bottom-section">
                                    <p><a href="#" class="button-sign-up">Register</a> with Perk to receive points when you shop.</p>
                    <p>Already a member? <a href="#" class="button-log-in">Sign in</a></p>
                            </div>
        </div>
    </div>
    
    <!-- Deals Overlay starts here -->
    <div class="overlay-fading"></div>
    <div class="overlay" id="deals">
        <div class="wrap">
            <a class="close" href="#"></a>
            <div class="top-section">
                <div class="store-left">
                    <div class="store-image"><img id="deal_image" src="https://placehold.it/120x60" alt="store-img"></div><span class="store-name" id="deal_merchant_name">Merchant</span>
                </div>
                <div class="right-section">
                    <div class="deal-info" id="deal_label">Deal</div>
                    <div class="save-code hide">Save</div>
                    <div class="save-code saved hide">Saved</div>
                    
                    <div class="validity">Valid now through <span id="deal_validity"></span></div>
                    <div class="store-desc" id="deal_desc">Shop <a href="#">Macys.com</a> now for Friends &amp; Family - <a href="#">40% off everything</a>, plus free shipping if you spend $50. Hurry, this offer expires today!</div>
                    <div class="information">No Code Required. Auto Applied at Checkout.</div>
                </div>
            </div>
            <div class="middle-section">
                <a href="#" class="info">What are points?</a>
                <div class="points-info-box">
                    <p>You earn <strong>Perk Points</strong> any time you shop online at participating merchants that can be later redeemed for gift cards.</p>
                </div>
                <a href="#" target="_blank" id="deal_shop_link" class="offer-text">Shop Now and <span id="deal_shop_text"></span>.</a>
            </div>
            <div class="bottom-section">
                                    <p><a href="#" class="button-sign-up">Register</a> with Perk to receive points when you shop.</p>
                    <p>Already a member? <a href="#" class="button-log-in">Sign in</a></p>
                            </div>
        </div>
    </div>

    <!-- Login-Signup Modal -->
    <div class="overlay" id="login-signup">
        <div class="wrap">
            <a class="close" href="#"></a>
            <img src="https://cdn2.perk.com/assets/perk_shopping/images/logo-perk-shopping.png" alt="perk shopping" class="perk-shopping-logo">
            <div class="tagline">Shop and Earn Points and Redeem for Gift Cards</div>
            <div class="header-image"></div>
            <div class="signup-form">
                <a href="#" class="fb-login-btn" onclick="facebook_connect('signup');"><span class="icon"></span>Sign Up with Facebook</a>
                <input type="email" class="user-email" id="sign-email" placeholder="Your Email">
                <div id="email-error" class="error"><span></span></div>
                <input type="password" class="user-pass" id="sign-pass" placeholder="Password" autocomplete="off">
                <div class="working">Loading ...</div>
                <button class="register-btn sign-up entered">Sign Up</button>
                <p>Already a member? <a href="#" id="sign-in">Sign in</a></p>
            </div>
            <div class="login-form">
                <a href="#" class="fb-login-btn" onclick="facebook_connect('login');"><span class="icon"></span>Log In with Facebook</a>
                <input type="email" class="user-email" id="login-email" placeholder="Your Email">
                <div id="login-email-error" class="error"><span></span></div>
                <input type="password" class="user-pass" id="login-pass" placeholder="Password" autocomplete="off">
                <div id="login-password-error" class="error"><span></span></div>
                <div id="login-form-error" class="error"><span></span></div>
                <!-- Adding captcha for login form -->
                <div id="recaptcha-html" style="margin-bottom:15px; display:none">
                    <script type="text/javascript"> var RecaptchaOptions = { theme:"red", lang:"en",  }; </script>
        		<script type="text/javascript" src="https://www.google.com/recaptcha/api/challenge?k=6LdfbwUTAAAAAG33L7yEojdFazshHnY0gLVigARv"></script>

            <noscript>
                    <iframe src="https://www.google.com/recaptcha/api/noscript?k=6LdfbwUTAAAAAG33L7yEojdFazshHnY0gLVigARv" height="300" width="500" frameborder="0"></iframe><br/>
                    <textarea id="recaptcha_challenge_field" name="recaptcha_challenge_field" rows="3" cols="40"></textarea>
                    <input type="hidden" id="recaptcha_response_field" name="recaptcha_response_field" value="manual_challenge"/>
            </noscript>                </div>
                <div class="working">Loading ...</div>
                <button class="login-btn sign-up entered">Sign In</button>
                <p>Don't have an account? <a href="#" id="sign-up">Sign Up</a></p>
            </div>
        </div>
    </div>
	
	<!-- Perk footer -->
	<div class="clear"></div>
	<footer class="visible">
       
        <div class="wrapper">
            <img src="https://search-dev.perk.com/htmlperk/perktemplate/images/perk-logo.png" alt="" class="perk-logo">
            <div class="col1 first">
                <div class="header">Perk</div>               
                <ul>
                    <li><a href="/home">Home</a></li>
                    <li><a href="/about">About Us</a></li>
                    <li><a href="https://appsaholic.com/">Appsaholic</a></li>
                    <li><a href="http://ir.perk.com" target="_blank">Investors</a></li>
                    <li><a href="http://press.perk.com" target="_blank">Press</a></li>
                </ul>
            </div>
            <div class="col1">
                <div class="header">Earn</div>               
                <ul>
                    <li><a href="/apps">Our Apps</a></li>
                    <li><a href="/home">Search</a></li>
                    <li><a href="/offers">Offers</a></li>
                    <li><a href="/shop">Shop</a></li>
                    <li><a href="/perk/refer_friends">Invite</a></li>
                </ul>
            </div>
            <div class="col1">
                <div class="header">Connect</div>               
                <ul>
                    <li><a href="http://support.perk.com/anonymous_requests/new">Contact Us</a></li>
                    <li><a href="/ads">Advertise</a></li>
                    <li><a href="/partner">Partner</a></li>
                </ul>
                <div class="header">Support</div>               
                <ul>
                    <li><a href="http://support.perk.com/" target="_blank">Help Center</a></li>
                    <li><a href="/privacy">Privacy Policy</a></li>
                    <li><a href="/terms">Terms of Use</a></li>
                </ul>
            </div>
            <div class="col2">
                <div class="header">Follow Us</div>
                <ul>
                    <li class="fb"><a href="https://www.facebook.com/GetPerk" target="_blank"></a></li>
                    <li class="youtube"><a href="https://www.youtube.com/user/GetPerk" target="_blank"></a></li>
                    <li class="twitter"><a href="https://twitter.com/getperk" target="_blank"></a></li>
                    <li class="instagram"><a href="http://instagram.com/perkrewards" target="_blank"></a></li>
                    <li class="linkedin"><a href="http://www.linkedin.com/company/perk-com" target="_blank"></a></li>
                </ul>
            </div>
            <div class="clear"></div>
            <div class="footer-info">
                <p>Made with <img src="https://search-dev.perk.com/htmlperk/perktemplate/images/heart.png" alt=""> in Austin, Bangalore and Waterloo.<span>Copyright ï¿½ 2015 Perk.com</span></p>
        </div>
        </div>
    </footer>

    <script type="text/javascript">
    // sets device type based on the value passed
            var deviceType = 'web_browser';
        $(document).ready(function(){

        $("#login-signup").on("click", ".register-btn", function(e) {
            e.preventDefault();
            var signupEmailWrap = $('.signup-form .email-wrap');
            if (validateEmail($("#sign-email").val())) {
                if (signupEmailWrap.length > 0) {
                    signupEmailWrap.addClass('correct');
                }
            } else {
                signupEmailWrap.removeClass('correct');
            }
            var isValid = validateEmailAndPassword($("#sign-email").val(), $("#sign-pass").val());
            if(isValid == false) {
                return false;
            }
    
            $.ajax({
                url: window.location.protocol + "//" + "api.perk.com/api/register",
                type: 'POST',
                crossDomain: true,
                cache: false,
                data: { 
                    email: $("#login-signup #sign-email").val(), 
                    password: $("#login-signup #sign-pass").val(),
                    type: 'email',
                    device_type: deviceType,
                    client_id: "11111",
                    client_secret: "c437a24bf277dfea375f"
                },
                beforeSend: function() {
                    $("#login-signup .register-btn").css('display','none');
                    $("#login-signup .working").css('display','block');
                }
            }).done(function( data, textStatus, jqXHR ) {
                $("#login-signup .register-btn").css('display','block');
                $("#login-signup .working").css('display','none');
                
                console.log("Done response and json - response is " + JSON.stringify(jqXHR) + ' and textStatus is ' + textStatus);
                if(textStatus == "success" && jqXHR.status == '200' && jqXHR.statusText == "OK") {
                    console.log("Done - response data is " + data);
                    if(data.access_token != "") {
                        // Make AJAX call to set session.
                        $.ajax({
                            url: "/accounts/setusersession/",
                            type: 'POST',
                            crossDomain: true,
                            cache: false,
                            data: { 
                                access_token: data.access_token, 
                                user_id: data.user_id,
                                type: 'email'
                            }
                        }).done(function( data, textStatus, jqXHR ) {
                            console.log('Success callback - response is ' + data + 'textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                            $("#login-signup #sign-email").val('');
                            $("#login-signup #sign-pass").val('');
                            $("#login-signup #conf-pass").val('');
                            window.postMessage({action: 'register_success'}, document.location.href);
                            parent.postMessage({action: 'register_success'}, 'chrome-extension://ainlfnpknhkbcilobjophjcicheilkph');

                            setTimeout(function(){
                                window.location.reload();
                            }, 100);
                            
                        }).fail(function( jqXHR, textStatus ) {
                            console.log('eror here - textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                        });
                    }
                }
            }).fail(function( jqXHR, textStatus ) {
                $("#login-signup .register-btn").css('display','block');
                $("#login-signup .working").css('display','none');
                
                var response_text = jqXHR.responseText;
                response_text_json = JSON.parse(response_text);
                var response_text_error = response_text_json.error;
                
                if(typeof response_text_error != 'undefined') {
                    $("#login-signup #email-error span").html(response_text_error);
                    $("#login-signup #email-error").css('display', 'block');
                } else {
                    $("#login-signup #email-error").css('display', 'none');
                }
                console.log("Request failed: " + textStatus + ' and error is ' + JSON.stringify(jqXHR));
            });

            return false;
        });

        $("#login-signup").on("click", ".login-btn", function(e) {
            e.preventDefault();
            var loginEmailWrap = $('.login-form .email-wrap');
            if (validateEmail($("#login-email").val())) {
                if (loginEmailWrap.length > 0) {
                    loginEmailWrap.addClass('correct');
                }
            } else {
                loginEmailWrap.removeClass('correct');
            }
            // Client side validation. No AJAX call if this doesn't pass.
            var loginValidation = validateEmailLogin(
                $("#login-signup #login-email").val(), 
                $("#login-signup #login-pass").val()
            );
			var parsedValidation = JSON.parse(loginValidation);
            if(parsedValidation.isValid == false) {
                if(parsedValidation.emailErrorMessage != '') {
                    $("#login-signup #login-email-error span").html(parsedValidation.emailErrorMessage);
                    $("#login-signup #login-email-error").css('display', 'block');
                } else {
                    $("#login-signup #login-email-error").css('display', 'none');
                }
                
                if(parsedValidation.passwordErrorMessage != '') {
                    $("#login-signup #login-password-error span").html(parsedValidation.passwordErrorMessage);
                    $("#login-signup #login-password-error").css('display', 'block');
                } else {
                    $("#login-signup #login-password-error").css('display', 'none');
                }
				return false;
			}
            
            $.ajax({
                url: '/accounts/ajax_login',
                type: 'post',
                cache: false,
                data: {
                    email: $("#login-signup #login-email").val(), 
                    password: $("#login-signup #login-pass").val(),
                    recaptcha_challenge_field: $("#recaptcha_challenge_field").val(),
                    recaptcha_response_field: $("#recaptcha_response_field").val()
                },
                beforeSend: function() {
                    $(".register-btn").css('display','none');
                    $(".working").css('display','block');
                },
                success: function(response) {
                    if (response.number_of_attempts >= 4) {
                        $("#recaptcha-html").css('display','block');
                    }
                    // On invalid captcha, reload the captcha.
                    if (response.captchaValid == false) {
                        $('#recaptcha_reload').trigger('click');
                    }
                    $(".register-btn").css('display','block');
                    $(".working").css('display','none');
                    
                    // Call makeAPIAjaxCall only if ajsx_login returned success. 
                    if (typeof(response.success) != 'undefined' && response.success == true) {
                        makeAPIAjaxCall(response, $("#login-signup #login-email").val(), $("#login-signup #login-pass").val());
                    }
                    
                    if(typeof response.email_error != 'undefined' && response.email_error != null) {
                        $("#login-signup #login-email-error span").html(response.email_error);
                        $("#login-signup #login-email-error").css('display', 'block');
                    } else {
                        $("#login-signup #login-email-error").css('display', 'none');
                    }

                    if(typeof response.password_error != 'undefined' && response.password_error != null) {
                        $("#login-signup #login-password-error span").html(response.password_error);
                        $("#login-signup #login-password-error").css('display', 'block');
                    } else {
                        $("#login-signup #login-password-error").css('display', 'none');
                    }

                    if(typeof response.message != 'undefined' && response.message != null) {    
                        $("#login-signup #login-form-error span").html(response.message);
                        $("#login-signup #login-form-error").css('display', 'block');
                    } else {
                        $("#login-signup #login-form-error").css('display', 'none');
                    }                       
                }
            });
            
            return false;
        });
    });

    
    /**
     * This method makes a call to api to request access token,
     * gets and sets the access token.
     * console log messages only for debugging.
     */
    function makeAPIAjaxCall(response, loginEmail, loginPassword) {
        $.ajax({
            url: window.location.protocol + "//" + "api.perk.com/oauth/token",
            type: 'POST',
            crossDomain: true,
            cache: false,
            data: {
                grant_type: 'password',
                username: loginEmail, 
                password: loginPassword,
                type: 'email',
                device_type: deviceType,
                client_id: "11111",
                client_secret: "c437a24bf277dfea375f"
            }
        }).done(function( data, textStatus, jqXHR ) {
            // console.log("Done response and json - response is " + JSON.stringify(jqXHR) + ' and textStatus is ' + textStatus);
            if(textStatus == "success" && jqXHR.status == '200' && jqXHR.statusText == "OK") {
                // console.log("Done - response data is " + data);
                if(data.access_token != "") {
                    // Make AJAX call to set session.
                    $.ajax({
                        url: "/accounts/setusersession/",
                        type: 'POST',
                        crossDomain: true,
                        cache: false,
                        data: { 
                            access_token: data.access_token, 
                            user_id: data.user_id,
                            type: 'email'
                        }
                    }).done(function( data, textStatus, jqXHR ) {
                        console.log('Success callback - response is ' + data + 'textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                        if(typeof response.success != 'undefined' && response.success != null && response.success == true) {
                            window.postMessage({action: 'login_success'}, document.location.href);
                            $('.overlay_section').fadeOut();
                        }
                        // redirecting only if the user login succeeded
                        if (typeof response.email_error == 'undefined' && typeof response.password_error == 'undefined' && typeof response.message == 'undefined') {
                            setTimeout(function(){
                                window.location.reload();
                            }, 100);
                        }
                    }).fail(function( jqXHR, textStatus ) {
                        console.log('eror here - textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                    });
                }
            }
        }).fail(function( jqXHR, textStatus ) {
            console.log("Request failed: " + textStatus + ' and error is ' + JSON.stringify(jqXHR));
        });
    }


    // triggering on enter keys on password fields
    $("#login-signup").on("keypress", "#sign-pass", function(e) {
        console.log(e.keyCode);
        if (e.keyCode == 13) {
            $('.register-btn').trigger('click');
        }
    });

    $("#login-signup").on("keypress", "#login-pass", function(e) {
        if (e.keyCode == 13) {
            $('.login-btn').trigger('click');
        }
    });


    // fb login/sign up script
    window.fbAsyncInit = function() {
        FB.init({
            appId      : "211055039020468",
            version    : 'v2.2',
            status     : true, // check the login status upon init?
            cookie     : true, // set sessions cookies to allow your server to access the session?
            xfbml      : true  // parse XFBML tags on this page?
        });

        // Additional initialization code such as adding Event Listeners goes here
        var facebook_login_callback = function(actionType, access_token, callback) {
            FB.api('/me', function(response) {
                response.access_token = access_token;
                response.fb_user_id = response.id;
                response.partner_id = $("#partner-id").val();
                response.click_id = $("#click-id").val();
                window.fb_user_id = response.fb_user_id;
                if (actionType == 'signup') {
                    $.ajax({
                        url: window.location.protocol + "//" + "api.perk.com/api/register",
                        type: 'POST',
                        crossDomain: true,
                        cache: false,
                        data: { 
                            type: 'facebook',
                            device_type: deviceType,
                            fb_user_id: response.fb_user_id,
                            access_token: response.access_token,
                            client_id: "11111",
                            client_secret: "c437a24bf277dfea375f",
                            click_id: response.click_id
                        }
                    }).done(function( data, textStatus, jqXHR ) {
                        console.log("Done response and json - response is " + JSON.stringify(jqXHR) + ' and textStatus is ' + textStatus);
                        if(textStatus == "success" && jqXHR.status == '200' && jqXHR.statusText == "OK") {
                            console.log("Done - response data is " + data);
                            window.userData = data;
                            if(data.access_token != "") {
                                // Set the access token in SQLite.
                                $.ajax({
                                    url: "/accounts/setusersession/",
                                    type: 'POST',
                                    crossDomain: true,
                                    cache: false,
                                    data: { 
                                        access_token: data.access_token, 
                                        user_id: data.user_id,
                                        type: 'facebook',
                                        fb_access_token: access_token
                                    }
                                }).done(function( data, textStatus, jqXHR ) {
                                    window.postMessage({ action: 'register_success'}, document.location.href);
                                    parent.postMessage({ action: 'register_success', data: {
                                        access_token: userData.access_token, 
                                        user_id: userData.user_id,
                                        type: 'facebook',
                                        fb_access_token: access_token,
                                        fb_user_id: fb_user_id
                                    }}, window.location.protocol + '//perk.tv/');
                                    setTimeout(function(){
                                        window.location.reload();
                                    }, 100);
                                    console.log('Success callback - response is ' + data + 'textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                                }).fail(function( jqXHR, textStatus ) {
                                    console.log('eror here - textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                                });
                            }
                        }
                    }).fail(function( jqXHR, textStatus ) {
                        // Nothing to be done here.
                        console.log("Request failed: " + textStatus + ' and error is ' + JSON.stringify(jqXHR));
                    });
                } else if(actionType == 'login') {
                    $.ajax({
                        url: window.location.protocol + "//" + "api.perk.com/oauth/token",
                        type: 'POST',
                        crossDomain: true,
                        cache: false,
                        data: {
                            grant_type: 'facebook',
                            device_type: deviceType,
                            client_id: "11111",
                            client_secret: "c437a24bf277dfea375f",
                            fb_user_id: response.fb_user_id,
                            access_token: response.access_token
                        }
                    }).done(function( data, textStatus, jqXHR ) {
                        console.log("Done response and json - response is " + JSON.stringify(jqXHR) + ' and textStatus is ' + textStatus);
                        if(textStatus == "success" && jqXHR.status == '200' && jqXHR.statusText == "OK") {
                            console.log("Done - response data is " + data);
                            window.userData = data;
                            if(data.access_token != "") {
                                // Make AJAX call to set session.
                                $.ajax({
                                    url: "/accounts/setusersession/",
                                    type: 'POST',
                                    crossDomain: true,
                                    cache: false,
                                    data: { 
                                        access_token: data.access_token, 
                                        user_id: data.user_id,
                                        type: 'facebook',
                                        fb_access_token: access_token
                                    }
                                }).done(function( data, textStatus, jqXHR ) {
                                    console.log('Success callback - response is ' + data + 'textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                                    window.postMessage({ action: 'login_success'}, document.location.href);
                                    parent.postMessage({ action: 'login_success', data: { 
                                        access_token: userData.access_token, 
                                        user_id: userData.user_id,
                                        type: 'facebook',
                                        fb_access_token: access_token,
                                        fb_user_id: fb_user_id
                                    }}, window.location.protocol + '//perk.tv/');
                                    setTimeout(function(){
                                        window.location.reload();
                                    }, 100);
                                }).fail(function( jqXHR, textStatus ) {
                                    console.log('eror here - textStatus is ' + textStatus + ' and jqXHR is ' + JSON.stringify(jqXHR));
                                });
                            }
                        }
                    }).fail(function( jqXHR, textStatus ) {
                        console.log("Request failed: " + textStatus + ' and error is ' + JSON.stringify(jqXHR));
                    });
                }
            });

            FB.Event.subscribe('auth.login', function(response) {
                facebook_login_callback('', response.authResponse.accessToken, function() {
                });
            });

            FB.Event.subscribe('auth.authResponseChange', function(response) {
                facebook_login_callback('', response.authResponse.accessToken, function() {
                });
            });
            
        };
        
        FB.getLoginStatus(function(response) {
            if (response.status == 'connected') {
                facebook_connect = function(actionType) {
                    FB.login(function(response) {
                        if (response.authResponse) {
                            facebook_login_callback(actionType, response.authResponse.accessToken, function() {
                            });
                        }
                    }, {scope : 'public_profile, email'});
                };
            } else {
                
                facebook_connect = function(actionType) {
                    FB.login(function(response) {
                        if (response.authResponse) {
                            facebook_login_callback(actionType, response.authResponse.accessToken, function() {
                            });
                        }
                    }, {scope : 'public_profile, email'});
                };
                
            }
        });
    };

      // Load the SDK asynchronously
      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));

</script>    
</body>
</html>
